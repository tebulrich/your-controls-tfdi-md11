TFDI MD-11 Configuration File Generation - Continuation Instructions
====================================================================

PROJECT OVERVIEW
----------------
This project creates comprehensive YourControls configuration files for the TFDI Design MD-11 aircraft.
The configuration is organized into modular YAML files, with each module covering a specific panel/system.

DOCUMENTATION REFERENCES
------------------------
- Events: https://docs.tfdidesign.com/md11/integration-guide/events
- Variables: https://docs.tfdidesign.com/md11/integration-guide/variables

COMPLETED MODULES
-----------------
ALL MODULES COMPLETED - 100% COVERAGE ACHIEVED (1423/1423 events)

The following modules have been completed and verified:
1. TFDI_MD11_audio_panel.yaml - Audio panel controls (Captain, First Officer, Observer)
2. TFDI_MD11_radio_panel.yaml - Radio panel controls
3. TFDI_MD11_fmc_cdu.yaml - FMC/CDU button events (LMCDU, RMCDU, CDU, CMCDU)
4. TFDI_MD11_aft_overhead_panel.yaml - Aft overhead panel (APU, Fire, Cargo Smoke, GPWS, Evacuation)
5. TFDI_MD11_overhead_panel.yaml - Main overhead panel
6. TFDI_MD11_center_glareshield.yaml - Center glareshield / Autopilot Control Panel
7. TFDI_MD11_glareshield_left.yaml - Left glareshield
8. TFDI_MD11_glareshield_right.yaml - Right glareshield
9. TFDI_MD11_center_panel.yaml - Center panel
10. TFDI_MD11_pedestal.yaml - Pedestal controls
11. TFDI_MD11_left_side_panel.yaml - Left side panel
12. TFDI_MD11_right_side_panel.yaml - Right side panel
13. TFDI_MD11_left_ecp.yaml - Left ECP
14. TFDI_MD11_right_ecp.yaml - Right ECP
15. TFDI_MD11_left_yoke.yaml - Left yoke controls
16. TFDI_MD11_right_yoke.yaml - Right yoke controls
17. TFDI_MD11_flight_controls.yaml - Flight controls
18. TFDI_MD11_throttle.yaml - Throttle controls
19. TFDI_MD11_main_instruments_panel.yaml - Main instruments panel

All completed modules are included in: definitions/aircraft/TFDi Design - MD-11.yaml

All modules were generated using checklist/generate_module.py with automatic ToggleSwitch and
NumIncrement detection based on L: variables from checklist/variables.json.

CHECKLIST SYSTEM
----------------
The checklist/ folder contains JSON files for each panel/system category. Each JSON file lists all events
from the documentation that should be implemented for that category.

To check coverage for a specific category:
  python checklist/check_events.py <category_name>
  
Example:
  python checklist/check_events.py overhead_panel
  python checklist/check_events.py fmc
  
To check all categories:
  python checklist/check_events.py

The script will:
- Search for each event in the main aircraft YAML file and all module files
- Mark events as "// present" in the JSON file if found
- Report coverage percentage

HOW TO CREATE A NEW MODULE
--------------------------
1. Identify the checklist JSON file for the category you want to work on
2. Read the checklist JSON to see all events that need to be implemented
3. Create a new YAML file: definitions/modules/TFDI_MD11_<category_name>.yaml
4. Follow this structure:

   # TFDI MD-11 <Panel Name> Controls
   # Events reference: https://docs.tfdidesign.com/md11/integration-guide/events
   # Variables reference: https://docs.tfdidesign.com/md11/integration-guide/variables
   
   shared:
     - # Description of control group
       type: event  # or ToggleSwitch, NumIncrement, etc.
       event_name: EVENT_NAME_HERE
     -
       type: event
       event_name: ANOTHER_EVENT_NAME

5. Add events based on the checklist JSON file
6. Add the module to definitions/aircraft/TFDi Design - MD-11.yaml in the include: section
7. Run the check script to verify coverage
8. Continue until 100% coverage is achieved

EVENT TYPE PATTERNS
-------------------
1. ToggleSwitch - For controls with on/off state that have L: variables
   Example:
     type: ToggleSwitch
     var_name: L:MD11_VARIABLE_NAME
     var_units: Bool
     var_type: bool
     event_name: EVENT_DOWN
     off_event_name: EVENT_UP

2. event - For momentary button presses, wheel events, switches without state tracking
   Example:
     type: event
     event_name: EVENT_NAME

3. NumIncrement - For controls that increment/decrement values
   (Check existing modules for examples)

IMPORTANT NOTES
---------------
1. Observer events use "OBS_AUDIO_PNL_" prefix (NOT "PED_OBS_AUDIO_PNL_")
2. Captain/First Officer events use "PED_CPT_" and "PED_FO_" prefixes
3. Some controls have both button events (_BT_LEFT_BUTTON_DOWN/UP) and wheel events (_KB_WHEEL_UP/DOWN)
4. Not all events have corresponding L: variables - use "type: event" when no variable exists
5. Check the variables documentation to see if L: variables exist for toggle-style controls
6. The check_events.py script will mark events as "// present" in JSON files - this is normal

STATUS: ALL CATEGORIES COMPLETED
---------------------------------
All checklist categories have been implemented and verified with 100% coverage.

To verify coverage for any category:
  python3 checklist/check_events.py <category_name>

To verify all categories:
  python3 checklist/check_events.py

RECOMMENDED WORKFLOW
--------------------
1. Start with a smaller category (e.g., throttle.json, center_panel.json) to get familiar
2. Read the checklist JSON file for that category
3. Create the module YAML file
4. Add events systematically - group related events together with comments
5. Add the module to the main aircraft file's include: section
6. Run: python checklist/check_events.py <category>
7. Verify 100% coverage
8. Move to the next category

TIPS
----
- Look at existing modules (audio_panel.yaml, aft_overhead_panel.yaml) as examples
- Use grep to search for similar event patterns in existing modules
- The overhead_panel.json is the largest - save it for last or break it into sub-modules
- Always run the check script after adding events to verify they're being detected
- If events aren't being found, check for typos in event names
- YAML syntax is strict - ensure proper indentation (2 spaces)

FILE LOCATIONS
--------------
- Main aircraft config: definitions/aircraft/TFDi Design - MD-11.yaml
- Module files: definitions/modules/TFDI_MD11_*.yaml
- Checklist files: checklist/*.json
- Check script: checklist/check_events.py
- Module generator script: checklist/generate_module.py

MODULE GENERATOR SCRIPT
-----------------------
A Python script (checklist/generate_module.py) is available to automatically generate YAML module
files from JSON checklist files. This can save time when creating new modules.

Usage:
  python3 checklist/generate_module.py <category_name>
  python3 checklist/generate_module.py <category_name> --update
  python3 checklist/generate_module.py --regenerate-all

Examples:
  python3 checklist/generate_module.py center_panel
  python3 checklist/generate_module.py radio_panel --update
  python3 checklist/generate_module.py --regenerate-all

What it does:
1. Reads the checklist JSON file (checklist/<category_name>.json)
2. Extracts all events (automatically filters out "// present" markers)
3. Groups events by control type (buttons, wheels, switches, etc.)
4. Detects L: variables from checklist/variables.json to determine control types
5. Generates a properly formatted YAML module file with appropriate types (event, ToggleSwitch, NumIncrement)
6. Outputs to: definitions/modules/TFDI_MD11_<category_name>.yaml
7. Marks all implemented events as "// present" in the JSON checklist file

Features:
- Handles button DOWN/UP pairs automatically
- Groups wheel events (WHEEL_UP/WHEEL_DOWN)
- Handles switches with LEFT/RIGHT buttons
- Handles ground buttons (GRD_LEFT_BUTTON_DOWN)
- Automatically detects ToggleSwitch types for controls with Bool L: variables
- Automatically detects NumIncrement types for wheel controls with numeric L: variables
- Generates appropriate comments for each control group
- Creates the standard header with references to documentation
- Updates checklist JSON files to mark events as present

Flags:
- --update: Updates an existing YAML file instead of overwriting it (preserves existing structure)
- --regenerate-all: Deletes all TFDI_MD11_*.yaml modules, cleans "// present" comments from all JSON
  checklist files, regenerates all modules with the latest logic, and runs check_events.py to verify
  coverage. Useful for applying fixes across all modules.

IMPORTANT: Grouping Logic Fixes (Achieved 100% Coverage)
--------------------------------------------------------
The grouping logic in generate_module.py has been carefully refined to handle all event patterns:

1. Control Type Distinction:
   - Buttons (_BT) and switches (_SW) are now grouped separately even if they share the same base name
   - Example: LSIDE_TIMER_BT and LSIDE_TIMER_SW are separate controls
   - The base name preserves the _BT/_SW/_GRD suffix to prevent incorrect merging

2. Brightness Wheel Events:
   - _BRT_KB_WHEEL events now extract the full prefix (e.g., PED_DU1_BRT_KB instead of just BRT_KB_WHEEL)
   - This allows each brightness control (DU1, DU2, DU3, CMCDU, LMCDU, etc.) to be properly identified

3. Ground Button Events:
   - _GRD_LEFT_BUTTON_DOWN events are preserved as separate controls with _GRD suffix
   - Example: CTR_SLAT_STOW_GRD is distinct from CTR_SLAT_STOW (if it exists)

4. Switch RIGHT Buttons:
   - _SW_RIGHT_BUTTON_DOWN events are grouped with their corresponding _SW_LEFT_BUTTON_DOWN control
   - Both LEFT and RIGHT buttons are output as separate event entries in the YAML

5. L: Variable Detection:
   - The script loads variables from checklist/variables.json (1477 variables)
   - ToggleSwitch: Detected when button DOWN/UP pair has a corresponding Bool L: variable
   - NumIncrement: Detected when wheel UP/DOWN pair has a corresponding numeric L: variable
   - Event: Used when no L: variable exists for the control

These fixes ensure that all events are correctly grouped, generated, and detected, achieving 100%
coverage (1423/1423 events across all categories).

Note: The generated file may need manual review/adjustment for:
- Comment readability (the auto-generated comments are functional but may need refinement)
- Complex event patterns that don't follow standard conventions
- Any special formatting requirements

The script is particularly useful for categories with many events, as it ensures consistent
formatting and reduces the chance of typos.

PROJECT STATUS: COMPLETE
------------------------
All modules have been successfully generated and verified. The project achieved 100% event coverage
(1423/1423 events) across all 19 categories.

Key Achievements:
- All event patterns correctly identified and grouped
- ToggleSwitch and NumIncrement types automatically detected using L: variables
- All control types properly handled: buttons, switches, wheels, ground buttons
- Comprehensive coverage verification using check_events.py

If you need to regenerate all modules (e.g., after fixing bugs or improving the generator script):
  python3 checklist/generate_module.py --regenerate-all

This will:
1. Delete all existing TFDI_MD11_*.yaml module files
2. Clean "// present" comments from all JSON checklist files
3. Regenerate all modules with the latest logic
4. Run check_events.py to verify 100% coverage is maintained

The generate_module.py script can also be used for future aircraft configurations - just update
the checklist JSON files and variables.json with the new aircraft's events and variables.

